{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clerk Dashboard - QuickPass</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --primary-lightest: rgba(67, 97, 238, 0.1);
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --danger: #f72585;
      --warning: #f8961e;
      --dark: #2b2d42;
      --light: #ffffff;
      --gray: #adb5bd;
      --light-gray: #f8f9fa;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.12);
      --border-radius: 16px;
      --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    [data-theme="dark"] {
      --dark: #f0f0f0;
      --light: #1e1e2f;
      --light-gray: #252538;
      --gray: #5a5a72;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
      --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.35);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--light-gray);
      color: var(--dark);
      transition: var(--transition);
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2rem;
      position: relative;
      padding: 1rem 0;
    }

    h1 {
      color: var(--primary);
      margin: 1rem 0 2rem;
      font-size: 2.2rem;
      font-weight: 700;
      text-align: center;
      position: relative;
      display: inline-block;
      background: linear-gradient(90deg, var(--primary), var(--success));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 4px;
      background: linear-gradient(to right, var(--primary), var(--success));
      border-radius: 4px;
      opacity: 0.8;
    }

    .action-buttons {
      position: absolute;
      top: 0;
      right: 0;
      display: flex;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 0.7rem 1.4rem;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }

    .btn:focus:not(:active)::after {
      animation: ripple 0.8s ease-out;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(67, 97, 238, 0.3);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: #d31665;
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(247, 37, 133, 0.3);
    }

    .btn-toggle {
      position: absolute;
      top: 0;
      left: 0;
      background-color: var(--primary);
      color: white;
    }

    .btn-toggle:hover {
      background-color: var(--secondary);
      transform: translateY(-3px);
    }

    .search-form {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 3rem;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 20px;
    }

    .search-input {
      flex: 1;
      padding: 1rem 1.5rem;
      border: 2px solid var(--gray);
      border-radius: var(--border-radius);
      font-size: 1.05rem;
      transition: var(--transition);
      background-color: var(--light);
      color: var(--dark);
      max-width: 500px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--primary-lightest);
      transform: translateY(-2px);
    }

    .student-card {
      max-width: 800px;
      margin: 0 auto;
      background: var(--light);
      border-radius: var(--border-radius);
      padding: 2.5rem;
      box-shadow: var(--card-shadow);
      display: grid;
      grid-template-columns: 180px 1fr;
      gap: 2rem;
      align-items: center;
      transition: var(--transition);
      border-left: 6px solid var(--primary);
      animation: fadeIn 0.8s cubic-bezier(0.22, 1, 0.36, 1);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(67, 97, 238, 0.1);
    }

    .student-card:hover {
      box-shadow: var(--card-shadow-hover);
      transform: translateY(-5px) scale(1.01);
      border-color: var(--primary-light);
    }

    .student-image {
      width: 180px;
      height: 180px;
      border-radius: var(--border-radius);
      object-fit: cover;
      border: 4px solid var(--primary-light);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      transition: var(--transition);
      filter: grayscale(10%);
    }

    .student-image:hover {
      transform: scale(1.05);
      filter: grayscale(0%);
    }

    .student-details {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .student-details p {
      margin: 0;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 10px;
      line-height: 1.6;
    }

    .student-details strong {
      color: var(--primary);
      font-weight: 600;
      min-width: 120px;
      display: inline-block;
    }

    .status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 0.5rem 1.2rem;
      border-radius: 24px;
      font-weight: 600;
      font-size: 1rem;
      width: fit-content;
      transition: var(--transition);
    }

    .status.renewed {
      background-color: rgba(76, 201, 240, 0.15);
      color: var(--success);
      box-shadow: 0 2px 5px rgba(76, 201, 240, 0.1);
    }

    .status.not-renewed {
      background-color: rgba(247, 37, 133, 0.15);
      color: var(--danger);
      box-shadow: 0 2px 5px rgba(247, 37, 133, 0.1);
    }

    .no-results {
      text-align: center;
      padding: 3rem;
      background: var(--light);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      max-width: 700px;
      margin: 3rem auto;
      animation: fadeIn 0.8s cubic-bezier(0.22, 1, 0.36, 1);
      border: 1px dashed var(--gray);
    }

    .no-results p {
      color: var(--danger);
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes ripple {
      0% { transform: scale(0, 0); opacity: 0.5; }
      100% { transform: scale(30, 30); opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="header">
    <button class="btn btn-toggle" onclick="toggleDarkMode()">
      <i class="fas fa-moon"></i> <span class="toggle-text">Dark Mode</span>
    </button>
    <h1>Clerk Dashboard</h1>
    <div class="action-buttons">
      <a href="{% url 'logout' %}" class="btn btn-danger">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </div>

  <form class="search-form" method="GET" action="{% url 'clerk_dashboard' %}">
    <input type="text" name="query" value="{{ query }}" placeholder="Enter Username, ID, or Name" class="search-input" required />
    <button type="submit" class="btn btn-primary">
      <i class="fas fa-search"></i> Search
    </button>
  </form>

  {% if student %}
    <div class="student-card">
      {% if student.photo %}
        <img src="{{ student.photo.url }}" alt="Student Photo" class="student-image" />
      {% else %}
        <img src="{% static 'default_photo.jpg' %}" alt="Default Photo" class="student-image" />
      {% endif %}
      <div class="student-details">
        <p><strong>Name:</strong> <span>{{ student.full_name|default:"-" }}</span></p>
        <p><strong>Username:</strong> <span>{{ student.user.username|default:"-" }}</span></p>
        <p><strong>Course:</strong> <span>{{ student.course|default:"-" }}</span></p>
        <p><strong>Year:</strong> <span>{{ student.academic_year|default:"-" }}</span></p>
        <p><strong>Town:</strong> <span>{{ student.town.name|default:"-" }}</span></p>
        <p><strong>Status:</strong> 
          <span class="status {% if renewed_this_month %}renewed{% else %}not-renewed{% endif %}">
            {% if renewed_this_month %}
              <i class="fas fa-check-circle"></i> Renewed
            {% else %}
              <i class="fas fa-times-circle"></i> Not Renewed
            {% endif %}
          </span>
        </p>
      </div>
    </div>
  {% elif query %}
    <div class="no-results">
      <p><i class="fas fa-user-slash"></i> No student found for "{{ query }}"</p>
    </div>
  {% endif %}

  <script>
    function toggleDarkMode() {
      const body = document.body;
      const isDark = body.getAttribute('data-theme') === 'dark';
      const toggleText = document.querySelector('.toggle-text');
      if (isDark) {
        body.removeAttribute('data-theme');
        localStorage.setItem('theme', 'light');
        document.querySelector('.btn-toggle i').className = 'fas fa-moon';
        toggleText.textContent = 'Dark Mode';
      } else {
        body.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        document.querySelector('.btn-toggle i').className = 'fas fa-sun';
        toggleText.textContent = 'Light Mode';
      }
      const btn = document.querySelector('.btn-toggle');
      btn.style.transform = 'scale(0.95)';
      setTimeout(() => { btn.style.transform = 'scale(1)'; }, 150);
    }

    document.addEventListener('DOMContentLoaded', function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      const toggleText = document.querySelector('.toggle-text');
      if (savedTheme === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        document.querySelector('.btn-toggle i').className = 'fas fa-sun';
        toggleText.textContent = 'Light Mode';
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.querySelectorAll('button, a, input, .student-card').forEach(el => {
      el.style.transition = 'var(--transition)';
      el.addEventListener('mouseenter', () => { el.style.transform = 'translateY(-2px)'; });
      el.addEventListener('mouseleave', () => { el.style.transform = 'translateY(0)'; });
    });

    document.querySelectorAll('.btn').forEach(button => {
      button.addEventListener('click', function(e) {
        const existingRipples = this.querySelectorAll('.ripple');
        existingRipples.forEach(ripple => ripple.remove());
        const ripple = document.createElement('span');
        ripple.classList.add('ripple');
        const rect = this.getBoundingClientRect();
        ripple.style.left = `${e.clientX - rect.left}px`;
        ripple.style.top = `${e.clientY - rect.top}px`;
        this.appendChild(ripple);
        setTimeout(() => { ripple.remove(); }, 800);
        if (this.tagName === 'A') {
          setTimeout(() => { window.location.href = this.href; }, 300);
        }
      });
    });

    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, observerOptions);

    document.querySelectorAll('.student-card, .no-results').forEach(el => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(20px)';
      el.style.transition = 'opacity 0.6s cubic-bezier(0.22, 1, 0.36, 1), transform 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
      observer.observe(el);
    });
  </script>
</body>
</html>
